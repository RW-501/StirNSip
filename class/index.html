<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Class Details | Stir & Sip</title>
    <meta name="description" content="Stir N' Sip is the ultimate cooking class experience — sip, cook, and vibe while learning delicious recipes in a fun, social atmosphere.">
  <meta name="keywords" content="cooking classes, sip and cook, Stir N' Sip, food experience, date night, cooking events, social cooking">
  <meta name="author" content="Stir N' Sip">

  <!-- Favicon -->
  <link rel="icon" href="https://rw-501.github.io/StirNSip/assets/images/logo.png" type="image/png">
  <link rel="apple-touch-icon" href="https://rw-501.github.io/StirNSip/assets/images/logo.png">

  <!-- Open Graph (Facebook, LinkedIn, etc.) -->
  <meta property="og:title" content="Stir N' Sip | Sip, Learn, Get Cooked Up!">
  <meta property="og:description" content="Join Stir N' Sip for unique cooking classes where food, music, and vibes come together. Cook. Sip. Laugh.">
  <meta property="og:image" content="https://rw-501.github.io/StirNSip/assets/images/logo.png">
  <meta property="og:url" content="https://rw-501.github.io/StirNSip/">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Stir N' Sip | Sip, Learn, Get Cooked Up!">
  <meta name="twitter:description" content="Cooking classes with a vibe. Food, music, and good times with Stir N' Sip.">
  <meta name="twitter:image" content="https://rw-501.github.io/StirNSip/assets/images/logo.png">

  <!-- Theme color for browsers -->
  <meta name="theme-color" content="#111111">
  
  <link rel="stylesheet" href="https://rw-501.github.io/StirNSip/style.css">
  <style>
    body { font-family: 'Inter', sans-serif; margin:0; padding:0; line-height:1.6; background:#f9f9f9; color:#333; }

    
    .cta-btn { display:inline-block; margin:0.5rem 0.25rem; padding:0.6rem 1.2rem; background:#ff5722; color:#fff; border-radius:8px; text-decoration:none; transition:0.2s; }
    .cta-btn:hover { background:#e64a19; }
    .secondary-btn { background:#ffa726; color:#fff; }
    .secondary-btn:hover { background:#fb8c00; }
    .class-detail { max-width:900px; margin:2rem auto; background:#fff; padding:2rem; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
    .class-title { font-size:2rem; margin-bottom:1rem; text-align:center; }
    .cover-image { width:100%; height:auto; border-radius:12px; margin-bottom:1rem; }
    .class-meta { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-bottom:1.5rem; }
    .meta-item { background:#f4f4f4; padding:0.6rem 1rem; border-radius:8px; }
    .meta-label { font-weight:600; display:block; margin-bottom:0.2rem; color:#555; }
    .description, .recipe-section { margin-bottom:2rem; }
    .recipe-section { background:#fff3e0; padding:1rem 1.5rem; border-radius:10px; }
    .class-grid, .merch-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1rem; }
    .class-card, .merch-item { background:#fff; padding:1rem; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.05); transition:0.2s; }
    .class-card:hover, .merch-item:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.1); }
    .class-card h3, .merch-item p { margin:0.5rem 0; }
    footer { text-align:center; padding:1.5rem 0; background:#333; color:#fff; margin-top:2rem; }

    .class-card img, .merch-item img { transition:0.3s; }
.class-card:hover img, .merch-item:hover img { transform:scale(1.05); }
.class-card h3, .merch-item h3 { font-size:1.2rem; margin:0.5rem 0; }
.class-card p, .merch-item p { font-size:0.95rem; color:#555; }

/* Featured badge */
.featured-badge {
  position: absolute;
  top: 8px;
  left: 8px;
  background: #ff5722;
  color: #fff;
  font-size: 0.8rem;
  font-weight: bold;
  padding: 0.2rem 0.5rem;
  border-radius: 5px;
  text-transform: uppercase;
  z-index: 10;
}

/* Card hover overlay */
.card-overlay {
  position: absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background: rgba(0,0,0,0.5);
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  opacity:0;
  transition:0.3s;
  border-radius:10px;
  text-align:center;
  padding:1rem;
}

.class-card:hover .card-overlay,
.merch-item:hover .card-overlay {
  opacity:1;
}

.class-card, .merch-item {
  position: relative; /* for badge and overlay */
  overflow: hidden;
}

/* Fade-up animation for cards */
@keyframes fadeUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-card {
  opacity: 0; /* start hidden */
  animation: fadeUp 0.6s forwards;
}

  </style>
</head>
<body>


<!-- HEADER --> 
<header class="sticky-header">
  <nav class="nav-container">
    <a href="https://rw-501.github.io/StirNSip/index.html" class="logo">Stir N' Sip</a>
    
    <!-- Hamburger -->
    <button class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <ul class="nav-links" id="navLinks">
      <li><a href="https://rw-501.github.io/StirNSip/index.html#aboutSection">About</a></li>
      <li><a href="https://rw-501.github.io/StirNSip/index.html#classesSection">Classes</a></li>
      <li><a href="https://rw-501.github.io/StirNSip/index.html#merchSection">Merch</a></li>
      <li><a href="https://rw-501.github.io/StirNSip/index.html#faqSection">FAQ</a></li>
      <li><a href="https://rw-501.github.io/StirNSip/index.html#gallerySection">Gallery</a></li>
      <li><a href="https://rw-501.github.io/StirNSip/index.html#contactSection">Contact</a></li>
    </ul>
  </nav>
</header>
  <!-- CLASS DETAIL -->
  <section id="class-detail" class="class-detail">
    <h1 id="className" class="class-title">Loading...</h1>
    <img id="coverImage" class="cover-image" src="" alt="Class cover image">

    <div class="class-meta">
      <div class="meta-item"><span class="meta-label">Dates:</span><span id="classDate" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">Times:</span><span id="classTime" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">Vibe:</span><span id="classVibe" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">Class Size:</span><span id="classSize" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">Spots Available:</span><span id="spotsAvailable" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">Singles Cost:</span><span id="singlesCost" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">Couples Cost:</span><span id="couplesCost" class="meta-value"></span></div>
      <div class="meta-item"><span class="meta-label">What We’re Cooking:</span><span id="whatCooking" class="meta-value"></span></div>
    </div>

    <div class="buy-buttons">
      <a id="eventbriteBtn" href="#" target="_blank" class="cta-btn">Buy on Eventbrite</a>
      <a id="otherBuyBtn" href="#" target="_blank" class="cta-btn secondary-btn">Buy Now</a>
    </div>

    <div class="description">
      <h2>Description</h2>
      <p id="classDescription"></p>
    </div>

    <div id="recipe-section" class="recipe-section">
      <h2>Recipe & Extras</h2>
      <div id="recipeContent">
        <p>Recipes and extras will appear here for this class.</p>
      </div>
    </div>
  </section>

  <!-- UPCOMING CLASSES -->
  <section id="upcomingClasses" class="classes">
    <h2>Upcoming Classes</h2>
    <div id="classesList" class="class-grid"></div>
  </section>

  <!-- MERCH SECTION -->
  <section id="merchSection" class="merch">
    <h2>Merch</h2>
    <div id="merchList" class="merch-grid"></div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 Stir & Sip</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, getDocs, query, orderBy, where } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { showToast } from 'https://rw-501.github.io/StirNSip/js/showToast.js';

        
    import { initImagePopup } from 'https://rw-501.github.io/StirNSip/js/imagePopup.js';

    // Firebase config
const firebaseConfig = { 
  apiKey: "AIzaSyBlN_vkUzQMfsCSFttdKA2ZMNz8v26JrQ8",
  authDomain: "stirnsip-978dc.firebaseapp.com",
  projectId: "stirnsip-978dc",
  storageBucket: "stirnsip-978dc.firebasestorage.app",
  messagingSenderId: "727033774529",
  appId: "1:727033774529:web:b2d103f6231bec75916f40",
  measurementId: "G-E72374YTPE"
};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const classId = new URLSearchParams(window.location.search).get("id");

    const elements = {
      classNameEl: document.getElementById("className"),
      coverImageEl: document.getElementById("coverImage"),
      classDateEl: document.getElementById("classDate"),
      classTimeEl: document.getElementById("classTime"),
      classDescriptionEl: document.getElementById("classDescription"),
      classVibeEl: document.getElementById("classVibe"),
      classSizeEl: document.getElementById("classSize"),
      spotsAvailableEl: document.getElementById("spotsAvailable"),
      singlesCostEl: document.getElementById("singlesCost"),
      couplesCostEl: document.getElementById("couplesCost"),
      whatCookingEl: document.getElementById("whatCooking"),
      recipeContentEl: document.getElementById("recipeContent"),
      eventbriteBtn: document.getElementById("eventbriteBtn"),
      otherBuyBtn: document.getElementById("otherBuyBtn"),
    };

    function formatDate(dateStr) {
      const options = { weekday:"short", month:"short", day:"numeric", year:"numeric" };
      return new Date(dateStr).toLocaleDateString("en-US", options);
    }

    
    function formatTime(timeStr) {
  if (!timeStr) return "TBD"; // return if undefined
  const [h,m] = timeStr.split(":").map(Number);
  const date = new Date();
  date.setHours(h, m);
  return date.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});
}


    async function loadClassDetails() {
      if (!classId) { elements.classNameEl.textContent="Class not found"; return; }
      try {
        const docSnap = await getDoc(doc(db,"classes",classId));
        if (!docSnap.exists()) { elements.classNameEl.textContent="Class not found"; return; }
        const data = docSnap.data();

        elements.classNameEl.textContent = data.name;
        elements.coverImageEl.src = data.coverImage || "";
        elements.coverImageEl.alt = data.name;

if (data.dateTimes && data.dateTimes.length) {
  elements.classDateEl.textContent = data.dateTimes.map(dt => formatDate(dt.date)).join(", ");
  elements.classTimeEl.textContent = data.dateTimes
    .map(dt => dt.time ? formatTime(dt.time) : "TBD")
    .join(", ");
} else {
  elements.classDateEl.textContent = formatDate(data.firstDate);
  elements.classTimeEl.textContent = "TBD";
}


        elements.classDescriptionEl.textContent = data.description;
        elements.classVibeEl.textContent = `${data.vibe || "N/A"}`;
        elements.classSizeEl.textContent = `${data.classSize || 0}`;
        elements.spotsAvailableEl.textContent = `${data.spotsAvailable || 0}`;
        elements.singlesCostEl.textContent = `$${data.singlesCost?.toFixed(2) || 0}`;
        elements.couplesCostEl.textContent = `$${data.couplesCost?.toFixed(2) || 0}`;
        elements.whatCookingEl.textContent = `${data.whatCooking || "TBD"}`;
        elements.recipeContentEl.innerHTML = data.recipe || "<p>Recipe coming soon!</p>";

        elements.eventbriteBtn.href = data.eventbriteLink || "#";
        elements.otherBuyBtn.href = data.otherBuyLink || "#";

      } catch(err){ console.error(err); elements.classNameEl.textContent="Error loading class"; }
    }

 
    
    // --- LOAD UPCOMING CLASSES ---
async function loadUpcomingClasses() {
  const classesList = document.getElementById("classesList");
  classesList.innerHTML = ""; // clear existing

  try {
    // Firestore requires 'where' before 'orderBy'
    const q = query(
      collection(db, "classes"),
      where("active", "==", true)
    );

    const snapshot = await getDocs(q);
    console.log("loadUpcomingClasses snapshot: ", snapshot);

    if (snapshot.empty) {
      classesList.innerHTML = "<p>No upcoming classes.</p>";
      return;
    }

    snapshot.forEach((docSnap, index) => {
      const data = docSnap.data();
      console.log("Classes data: ", data);

      // If firstDate is string, convert to Date object for formatting
      const firstDate = data.firstDate ? new Date(data.firstDate) : null;
      const dateStr = firstDate ? firstDate.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" }) : "TBD";

      const div = document.createElement("div");
      div.classList.add("class-card", "animate-card");
      div.style.animationDelay = `${index * 0.1}s`; // stagger each card

      div.innerHTML = `
        ${data.featured ? '<div class="featured-badge">Featured</div>' : ''}
        <img src="${data.coverImage || ''}" alt="${data.name}" style="width:100%;border-radius:10px;object-fit:cover;height:160px;">
        <div class="card-overlay">
          <p>${data.description?.slice(0, 100) || ''}...</p>
        </div>
        <h3>${data.name}</h3>
        <p>${dateStr} | ${data.time || 'TBD'}</p>
        <p>Price: $${data.singlesCost?.toFixed(2) || 0}</p>
        <a href="https://rw-501.github.io/StirNSip/class/index.html?id=${docSnap.id}" class="cta-btn" style="width:100%;text-align:center;margin-top:0.5rem;">View Details</a>
      `;
      classesList.appendChild(div);
    });

    
  // Initialize popup for all gallery images
  initImagePopup('img');

  } catch (err) {
    console.error(err);
    showToast("Error loading classes");
  }
}


// --- LOAD MERCH ---
async function loadMerch() {
  const merchList = document.getElementById("merchList");
  merchList.innerHTML = "";
  
  try {
    const snapshot = await getDocs(collection(db, "merch"));
    
    snapshot.forEach((docSnap, index) => {
      const data = docSnap.data();
      const div = document.createElement("div");
      div.classList.add("merch-item", "animate-card");
      div.style.animationDelay = `${index * 0.1}s`; // stagger each card

            
      const isAvailable = data.available > 0 && data.link;

      // Build main image & thumbnails
      const mainImage = data.images && data.images.length > 0 ? data.images[0] : data.coverImage || '';
      const thumbsHtml = (data.images || []).map((img, i) => `
        <img src="${img}" class="thumb ${i === 0 ? 'active' : ''}" style="width:40px;height:40px;border-radius:4px;cursor:pointer;margin:2px;">
      `).join("");

      div.innerHTML = `
        ${data.featured ? '<div class="featured-badge">Featured</div>' : ''}
        <div class="merch-main-img">
          <img src="${mainImage}" alt="${data.name}" class="main-img" style="width:100%;height:160px;object-fit:cover;border-radius:10px;">
        </div>
        <div class="merch-thumbs" style="display:flex;justify-content:center;flex-wrap:wrap;">
          ${thumbsHtml}
        </div>
        <h3>${data.name}</h3>
        <p>${data.description || ''}</p>
        <p>Cost: $${data.cost?.toFixed(2) || 0}</p>
               
        <a href="${isAvailable ? data.link : '#'}" target="_blank" 
           class="cta-btn" 
           style="pointer-events:${isAvailable ? "auto" : "none"}; opacity:${isAvailable ? 1 : 0.5}">
          ${isAvailable ? "Buy Now" : "Coming Soon"}
        </a>

        <a href="${data.link || '#'}" target="_blank" class="cta-btn" style="width:100%;text-align:center;margin-top:0.5rem;">Buy Now</a>
      `;
      merchList.appendChild(div);

      // Thumbnail click logic
      const mainImgEl = div.querySelector(".merch-main-img img");
      div.querySelectorAll(".merch-thumbs .thumb").forEach(thumb => {
        thumb.addEventListener("click", () => {
          mainImgEl.src = thumb.src;
          div.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
          thumb.classList.add("active");
        });
      });
    });

    
  // Initialize popup for all gallery images
  initImagePopup('img');

  } catch(err) { 
    console.error(err); 
    showToast("Error loading merch"); 
  }
}


// Call them after class details
loadClassDetails();
loadUpcomingClasses();
loadMerch();


  const hamburger = document.getElementById("hamburger");
  const navLinks = document.getElementById("navLinks");

  hamburger.addEventListener("click", () => {
    hamburger.classList.toggle("active");
    navLinks.classList.toggle("show");
  });


  </script>
</body>
</html>
